{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Complex MongoDB Atlas SearchDeployment CloudFormation Template with all configuration fields",
  "Parameters": {
    "Profile": {
      "Type": "String",
      "Default": "default",
      "Description": "Secret Manager Profile that contains the Atlas Programmatic keys."
    },
    "ProjectId": {
      "Type": "String",
      "Description": "Unique 24-hexadecimal character string that identifies the project.",
      "MinLength": 24,
      "MaxLength": 24,
      "AllowedPattern": "^([a-f0-9]{24})$"
    },
    "ClusterName": {
      "Type": "String",
      "Description": "Label that identifies the cluster to return the search nodes for."
    },
    "InstanceSize": {
      "Type": "String",
      "Description": "Hardware specification for the search node instance sizes. Valid values: S10_HIGHCPU_NVME, S20_HIGHCPU_NVME, S30_HIGHCPU_NVME, S40_HIGHCPU_NVME, S50_HIGHCPU_NVME, etc.",
      "Default": "S30_HIGHCPU_NVME",
      "AllowedValues": [
        "S10_HIGHCPU_NVME",
        "S20_HIGHCPU_NVME",
        "S30_HIGHCPU_NVME",
        "S40_HIGHCPU_NVME",
        "S50_HIGHCPU_NVME"
      ]
    },
    "NodeCount": {
      "Type": "Number",
      "Description": "Number of search nodes in the cluster.",
      "Default": 2,
      "MinValue": 1,
      "MaxValue": 10
    }
  },
  "Resources": {
    "SearchDeployment": {
      "Type": "MongoDB::Atlas::SearchDeployment",
      "Properties": {
        "Profile": {
          "Ref": "Profile"
        },
        "ProjectId": {
          "Ref": "ProjectId"
        },
        "ClusterName": {
          "Ref": "ClusterName"
        },
        "Specs": [
          {
            "InstanceSize": {
              "Ref": "InstanceSize"
            },
            "NodeCount": {
              "Ref": "NodeCount"
            }
          }
        ]
      }
    }
  },
  "Outputs": {
    "SearchDeploymentId": {
      "Description": "Unique 24-hexadecimal digit string that identifies the search deployment.",
      "Value": {
        "Fn::GetAtt": [
          "SearchDeployment",
          "Id"
        ]
      }
    },
    "SearchDeploymentStateName": {
      "Description": "Human-readable label that indicates the current operating condition of this search deployment.",
      "Value": {
        "Fn::GetAtt": [
          "SearchDeployment",
          "StateName"
        ]
      }
    },
    "SearchDeploymentEncryptionAtRestProvider": {
      "Description": "Cloud service provider that manages your customer keys to provide an additional layer of Encryption At Rest for the cluster.",
      "Value": {
        "Fn::GetAtt": [
          "SearchDeployment",
          "EncryptionAtRestProvider"
        ]
      }
    },
    "ClusterName": {
      "Description": "Cluster name for reference",
      "Value": {
        "Ref": "ClusterName"
      }
    },
    "ProjectId": {
      "Description": "Project ID for reference",
      "Value": {
        "Ref": "ProjectId"
      }
    },
    "ConfigurationSummary": {
      "Description": "Summary of search deployment configuration",
      "Value": {
        "Fn::Join": [
          "",
          [
            "Search Deployment created for cluster ",
            {
              "Ref": "ClusterName"
            },
            " with ",
            {
              "Ref": "NodeCount"
            },
            " node(s) of size ",
            {
              "Ref": "InstanceSize"
            }
          ]
        ]
      }
    }
  }
}

